<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mycompany.miniproject.dao.ReviewDao">
	<select id="selectReviewList" parameterType="int" resultType="Review">
		select review_score, review_content, review_image_data,
			review_image_name, review_image_type, order_id
			created_at, user_id
		from review
		where product_id = #{productId} and review_enable=1
	</select>
	
	<select id="selectReview" parameterType="map" resultType="Review">
		select review_image_data, review_image_name, review_image_type
		from review
		where user_id = #{userID} and product_id = #{productID} and order_id = #{orderId}
	</select>
	
	<insert id="insertReview" parameterType="map">
		<selectKey keyProperty="reviewId" resultType="int" order="BEFORE" >
			select reviews_seq.nextval from dual
		</selectKey>
		insert into review (
			review_id, order_id, product_id, user_id, review_enable, created_at
		) values (
			#{reviewId}, #{orderId}, #{productId}, #{userId}, 0, sysdate
		)
	</insert>
</mapper>